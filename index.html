<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Para Ti, Mi Todo</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@600&family=Parisienne&family=Montserrat:wght@300&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Montserrat', sans-serif;
        }

        /* --- PANTALLA DE INICIO (Heartbeat) --- */
        #intro-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 500;
            transition: opacity 2s;
        }
        .heart-btn {
            font-size: 4rem;
            background: none;
            border: none;
            cursor: pointer;
            animation: heartbeat 1.5s infinite;
            filter: drop-shadow(0 0 20px rgba(255, 0, 0, 0.6));
        }
        @keyframes heartbeat {
            0% { transform: scale(1); }
            15% { transform: scale(1.3); }
            30% { transform: scale(1); }
            45% { transform: scale(1.15); }
            60% { transform: scale(1); }
        }
        .intro-text {
            color: #fff;
            margin-top: 20px;
            opacity: 0.7;
            letter-spacing: 2px;
            font-size: 0.9rem;
        }

        /* --- CAPAS DEL JUEGO --- */
        #canvas { display: block; opacity: 0; transition: opacity 3s; }
        
        #ui-layer {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            pointer-events: none;
            opacity: 0;
            transition: opacity 2s;
        }
        
        /* Botón Mágico para el final */
        #love-btn {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 30px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Cinzel', serif;
            letter-spacing: 2px;
            pointer-events: auto;
            backdrop-filter: blur(5px);
            transition: all 0.5s;
            opacity: 0; /* Aparece después */
        }
        #love-btn:hover {
            background: rgba(255, 105, 180, 0.3);
            box-shadow: 0 0 20px #ff69b4;
            transform: translateX(-50%) scale(1.1);
        }

        /* --- LA CARTA (SCROLLING TEXT) --- */
        #letter-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none; /* Se activa al final */
            justify-content: center;
            align-items: center;
            z-index: 200;
            overflow: hidden;
        }
        #scrolling-text {
            color: #fff;
            text-align: center;
            font-family: 'Parisienne', cursive;
            font-size: 1.8rem;
            line-height: 1.8;
            max-width: 90%;
            text-shadow: 0 0 10px rgba(255, 192, 203, 0.5);
            position: absolute;
            top: 100%; /* Empieza abajo */
            animation: scrollUp 40s linear forwards; /* AJUSTA 40s SI LA CARTA ES MUY LARGA */
        }
        @keyframes scrollUp {
            0% { top: 100%; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: -150%; opacity: 0; }
        }

        /* Tarjeta de Mensajes Cortos */
        #message-card {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(20, 20, 30, 0.8);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            text-align: center;
            transition: all 0.3s;
            max-width: 300px;
            pointer-events: auto;
        }
        #message-card.active { transform: translate(-50%, -50%) scale(1); }

    </style>
</head>
<body>

    <div id="intro-screen">
        <button class="heart-btn" onclick="startExperience()">❤️</button>
        <div class="intro-text">Toca el corazón para comenzar</div>
    </div>

    <div id="ui-layer">
        <h1 style="font-family: 'Cinzel'; color: white; text-shadow: 0 0 10px orchid;">Nuestro Mundo</h1>
    </div>

    <button id="love-btn" onclick="startFinale()">Leer mi corazón</button>

    <div id="message-card">
        <p id="msg-content" style="font-size: 1.2rem;">...</p>
        <button onclick="closeCard()" style="margin-top:15px; background:transparent; border:1px solid white; color:white; padding:5px 15px; border-radius:15px;">Cerrar</button>
    </div>

    <div id="letter-container">
        <div id="scrolling-text">
            </div>
    </div>

    <canvas id="canvas"></canvas>

    <audio id="bgm" loop>
        <source src="https://cdn.pixabay.com/download/audio/2022/02/07/audio_13a30dd227.mp3?filename=piano-moment-11634.mp3" type="audio/mpeg">
    </audio>

<script>
    /* =========================================
       ZONA DE PERSONALIZACIÓN (¡EDITA ESTO!)
       ========================================= */
    
    // 1. TU CARTA DE AMOR (Usa <br> para saltos de línea)
    const CARTA_AMOR = `
        Mi amor en el poco tiempo que llevamos
        Se que es una decision pronta mas sin embargo
        Esto es lo que siento porti, siento amor y atraccion por ti
        Eres lo mas lindo que me pudo haber toda, ademas de ser tu quien
        Yo quiero para formar una familia, tener niños y ser tu y yo siempre
        Te amo con todo mi corazon y ademas de sentir por ti se lo que eres
        Y se que la gran niña que tienes en tu corazon es mas que perfecta
        Te amo luci <3
        [De C.O]
    `;

    // 2. MENSAJES DE LAS FLORES
    const MENSAJES_FLORES = [
        "Te amo.", "Eres perfecta.", "Mi casualidad favorita.",
        "Siempre juntos.", "Me haces mejor persona.", "Tu risa es mi música."
    ];

    /* =========================================
       FIN DE ZONA DE PERSONALIZACIÓN
       ========================================= */

    document.getElementById('scrolling-text').innerHTML = CARTA_AMOR;

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let width, height;
    let gameState = 'intro'; // intro, playing, finale

    // Objetos
    let flores = [];
    let particulas = [];
    let fuegosArtificiales = [];
    let estrellas = [];
    let conejo;

    function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
        conejo = new Conejo(width/2, height * 0.85);
    }
    window.addEventListener('resize', resize);

    // --- CLASES ---

    class Conejo {
        constructor(x, y) {
            this.x = x; this.y = y; this.scale = 1;
            this.lookAtMoon = false;
        }
        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            // Si es final, mira arriba
            if(this.lookAtMoon) ctx.rotate(-0.2);
            
            ctx.scale(this.scale, this.scale);
            
            // Sombra
            ctx.fillStyle = 'rgba(0,0,0,0.5)';
            ctx.beginPath(); ctx.ellipse(0, 50, 60, 15, 0,0,Math.PI*2); ctx.fill();

            // Cuerpo
            ctx.fillStyle = '#fff';
            ctx.beginPath(); ctx.ellipse(0, 40, 70, 55, 0,0,Math.PI*2); ctx.fill();
            
            // Cabeza
            ctx.beginPath(); ctx.arc(0, -10, 50, 0, Math.PI*2); ctx.fill();

            // Orejas
            this.drawEar(-30, -50, -0.2);
            this.drawEar(30, -50, 0.2);

            // Cara
            if(!this.lookAtMoon) {
                ctx.fillStyle = '#f00'; // Nariz
                ctx.beginPath(); ctx.arc(0, 0, 8, 0, Math.PI*2); ctx.fill();
                ctx.fillStyle = '#000'; // Ojos
                ctx.beginPath(); ctx.arc(-20, -15, 6, 0, Math.PI*2); ctx.fill();
                ctx.beginPath(); ctx.arc(20, -15, 6, 0, Math.PI*2); ctx.fill();
            } else {
                // De espaldas/mirando arriba
                ctx.fillStyle = 'pink'; // Colita
                ctx.beginPath(); ctx.arc(0, 70, 15, 0, Math.PI*2); ctx.fill();
            }
            ctx.restore();
        }
        drawEar(x, y, a) {
            ctx.save(); ctx.translate(x,y); ctx.rotate(a);
            ctx.fillStyle = '#fff';
            ctx.beginPath(); ctx.ellipse(0, -30, 15, 40, 0,0,Math.PI*2); ctx.fill();
            ctx.fillStyle = 'pink';
            ctx.beginPath(); ctx.ellipse(0, -30, 8, 30, 0,0,Math.PI*2); ctx.fill();
            ctx.restore();
        }
    }

    class Astromelia {
        constructor(x, y) {
            this.x = x; this.y = y; this.size = 0; this.max = 40 + Math.random()*30;
            this.msg = MENSAJES_FLORES[Math.floor(Math.random()*MENSAJES_FLORES.length)];
            this.color = `hsl(${Math.random()*60 + 300}, 80%, 60%)`; // Rosas/Morados
        }
        update() { if(this.size < this.max) this.size += (this.max - this.size)*0.05; }
        draw(t) {
            const wind = Math.sin(t*0.002 + this.x)*5;
            ctx.save();
            ctx.translate(this.x + wind, this.y);
            // Tallo
            ctx.strokeStyle = 'green'; ctx.lineWidth = 3;
            ctx.beginPath(); ctx.moveTo(0, height-this.y); ctx.quadraticCurveTo(0, (height-this.y)/2, 0, 0); ctx.stroke();
            
            // Flor
            ctx.fillStyle = this.color;
            for(let i=0; i<6; i++) {
                ctx.save(); ctx.rotate(i*Math.PI/3);
                ctx.beginPath(); ctx.ellipse(0, -this.size, this.size*0.3, this.size, 0,0,Math.PI*2); ctx.fill();
                ctx.restore();
            }
            ctx.fillStyle = 'yellow'; ctx.beginPath(); ctx.arc(0,0,this.size*0.2,0,Math.PI*2); ctx.fill();
            ctx.restore();
        }
    }

    class Firework {
        constructor() {
            this.x = Math.random() * width;
            this.y = height;
            this.targetY = Math.random() * height * 0.5;
            this.speed = 10 + Math.random()*5;
            this.color = `hsl(${Math.random()*360}, 100%, 70%)`;
            this.exploded = false;
            this.particles = [];
        }
        update() {
            if(!this.exploded) {
                this.y -= this.speed;
                this.speed *= 0.98;
                if(this.y <= this.targetY || this.speed < 1) {
                    this.explode();
                }
            } else {
                this.particles.forEach(p => p.update());
                this.particles = this.particles.filter(p => p.alpha > 0);
            }
        }
        explode() {
            this.exploded = true;
            // Forma de corazón
            for(let i=0; i<50; i++) {
                const angle = (Math.PI * 2 * i) / 50;
                // Ecuación del corazón
                const r = 2; // velocidad
                const heartX = 16 * Math.pow(Math.sin(angle), 3);
                const heartY = -(13 * Math.cos(angle) - 5 * Math.cos(2 * angle) - 2 * Math.cos(3 * angle) - Math.cos(4 * angle));
                
                this.particles.push(new Particle(this.x, this.y, heartX * 0.5, heartY * 0.5, this.color));
            }
        }
        draw() {
            if(!this.exploded) {
                ctx.fillStyle = this.color;
                ctx.beginPath(); ctx.arc(this.x, this.y, 3, 0, Math.PI*2); ctx.fill();
            } else {
                this.particles.forEach(p => p.draw());
            }
        }
    }

    class Particle {
        constructor(x, y, vx, vy, color) {
            this.x = x; this.y = y; this.vx = vx; this.vy = vy; this.color = color;
            this.alpha = 1; this.life = 0.01 + Math.random()*0.01;
        }
        update() {
            this.x += this.vx; this.y += this.vy;
            this.vy += 0.05; // gravedad
            this.alpha -= this.life;
        }
        draw() {
            ctx.globalAlpha = Math.max(0, this.alpha);
            ctx.fillStyle = this.color;
            ctx.beginPath(); ctx.arc(this.x, this.y, 2, 0, Math.PI*2); ctx.fill();
            ctx.globalAlpha = 1;
        }
    }

    // --- FUNCIONES DE CONTROL ---

    function startExperience() {
        document.getElementById('intro-screen').style.opacity = 0;
        setTimeout(() => { document.getElementById('intro-screen').style.display = 'none'; }, 2000);
        
        document.getElementById('canvas').style.opacity = 1;
        document.getElementById('ui-layer').style.opacity = 1;
        
        // Muestra el botón final después de 5 segundos
        setTimeout(() => {
            document.getElementById('love-btn').style.opacity = 1;
        }, 5000);

        // Música
        document.getElementById('bgm').play().catch(e => console.log("Audio requires interaction"));
        
        gameState = 'playing';
        resize();
        animate(0);
    }

    function startFinale() {
        gameState = 'finale';
        conejo.lookAtMoon = true;
        document.getElementById('ui-layer').style.opacity = 0;
        document.getElementById('love-btn').style.opacity = 0;
        document.getElementById('letter-container').style.display = 'flex';
        
        // Crear fuegos artificiales constantemente
        setInterval(() => {
            fuegosArtificiales.push(new Firework());
        }, 800);
    }

    // --- INPUTS ---
    canvas.addEventListener('mousedown', (e) => {
        if(gameState === 'finale') return;
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        // Check flores
        let clicked = false;
        flores.forEach(f => {
            if(Math.hypot(x-f.x, y-f.y) < f.max) {
                document.getElementById('msg-content').innerText = f.msg;
                document.getElementById('message-card').classList.add('active');
                clicked = true;
            }
        });

        if(!clicked && y > height*0.5) {
            flores.push(new Astromelia(x, y));
        }
    });

    function closeCard() { document.getElementById('message-card').classList.remove('active'); }

    // --- LOOP ---
    // Estrellas fondo
    for(let i=0; i<100; i++) estrellas.push({x: Math.random()*window.innerWidth, y: Math.random()*window.innerHeight, s: Math.random()});

    function animate(t) {
        // Fondo
        ctx.fillStyle = '#050510';
        ctx.fillRect(0,0,width,height);

        // Luna
        ctx.shadowBlur = 40; ctx.shadowColor = '#fff';
        ctx.fillStyle = '#ffffe0';
        ctx.beginPath(); ctx.arc(width-100, 100, 50, 0, Math.PI*2); ctx.fill();
        ctx.shadowBlur = 0;

        // Estrellas
        ctx.fillStyle = '#fff';
        estrellas.forEach(e => {
            ctx.globalAlpha = Math.random();
            ctx.beginPath(); ctx.arc(e.x, e.y, e.s, 0, Math.PI*2); ctx.fill();
        });
        ctx.globalAlpha = 1;

        // Flores
        flores.forEach(f => { f.update(); f.draw(t); });

        // Conejo
        if(conejo) conejo.draw();

        // Fuegos Artificiales (Solo en finale)
        if(gameState === 'finale') {
            fuegosArtificiales.forEach((fw, i) => {
                fw.update();
                fw.draw();
                if(fw.exploded && fw.particles.length === 0) fuegosArtificiales.splice(i, 1);
            });
        }

        requestAnimationFrame(animate);
    }

</script>
</body>
</html>
